<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Multi‑Colour – No 2×2 Monochrome Grid Demo</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      margin: 2rem;
    }
    canvas {
      border: 1px solid #444;
      aspect-ratio: 1 / 1; /* keep the canvas square */
      max-width: 90vmin;
      height: auto;
    }
    #controls {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    input, button {
      padding: 0.3rem 0.6rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #777;
    }
    button {
      cursor: pointer;
      background: #f5f5f5;
      transition: background 0.2s;
    }
    button:hover { background: #e0e0e0; }

    /* optional colour legend */
    #legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.3rem;
      margin-top: 1rem;
    }
    .swatch {
      width: 1.2rem;
      height: 1.2rem;
      border: 1px solid #333;
      border-radius: 0.2rem;
    }
  </style>
</head>
<body>
  <h1>No 2×2 Monochrome Grid – Multiple Colours</h1>
  <canvas id="grid" width="400" height="400"></canvas>

  <div id="controls">
    <label>Grid size (n × n):
      <input type="number" id="size" value="20" min="4" max="200" step="1" />
    </label>
    <label>Colours:
      <input type="number" id="colors" value="2" min="2" max="20" step="1" />
    </label>
    <button id="generate">Generate</button>
  </div>

  <div id="legend"></div>

  <script>
    /** Utility: map colour index ➜ distinct HSL string */
    function indexToColour(i, k) {
      if (k === 2) {
        return i === 0 ? "#fff" : "#000"; // keep classic BW for binary case
      }
      const hue = (i * 360) / k; // equally spaced hues
      return `hsl(${hue} 70% 50%)`;
    }

    /** Greedy fill that avoids monochrome 2×2 blocks for k colours. */
    function generateGrid(rows, cols, k) {
      const g = Array.from({ length: rows }, () => Array(cols).fill(0));

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          let forbidden = null;

          // Only the NW, N, W cells are relevant (already decided)
          if (
            r > 0 && c > 0 &&
            g[r - 1][c - 1] === g[r - 1][c] &&
            g[r - 1][c] === g[r][c - 1]
          ) {
            forbidden = g[r - 1][c - 1];
          }

          // Collect allowed colours
          const choices = [];
          for (let col = 0; col < k; col++) {
            if (col !== forbidden) choices.push(col);
          }
          // Pick one uniformly at random
          g[r][c] = choices[Math.floor(Math.random() * choices.length)];
        }
      }
      return g;
    }

    /** Draw the grid on the <canvas>. */
    function drawGrid(grid, k) {
      const canvas = document.getElementById("grid");
      const ctx = canvas.getContext("2d");
      const rows = grid.length;
      const cols = grid[0].length;
      const cellSize = Math.floor(
        Math.min(canvas.width / cols, canvas.height / rows)
      );

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          ctx.fillStyle = indexToColour(grid[r][c], k);
          ctx.fillRect(c * cellSize, r * cellSize, cellSize, cellSize);
        }
      }
    }

    /** Update colour legend swatches. */
    function drawLegend(k) {
      const legend = document.getElementById("legend");
      legend.innerHTML = "";
      for (let i = 0; i < k; i++) {
        const swatch = document.createElement("div");
        swatch.className = "swatch";
        swatch.style.background = indexToColour(i, k);
        legend.appendChild(swatch);
      }
    }

    /** Generate a new grid using current UI settings. */
    function run() {
      const size = parseInt(document.getElementById("size").value, 10);
      let k = parseInt(document.getElementById("colors").value, 10);
      if (isNaN(k) || k < 2) k = 2;
      const grid = generateGrid(size, size, k);
      drawGrid(grid, k);
      drawLegend(k);
    }

    document.getElementById("generate").addEventListener("click", run);
    window.addEventListener("load", run); // initial draw on page load
  </script>
</body>
</html>
