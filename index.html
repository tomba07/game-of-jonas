<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>No 2×2 Monochrome **or Checkerboard** Grid Demo</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      margin: 2rem;
    }
    canvas {
      border: 1px solid #444;
      aspect-ratio: 1 / 1; /* keep the canvas square */
      max-width: 90vmin;
      height: auto;
    }
    #controls {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }
    input, button {
      padding: 0.3rem 0.6rem;
      font-size: 1rem;
      border-radius: 0.5rem;
      border: 1px solid #777;
    }
    button {
      cursor: pointer;
      background: #f5f5f5;
      transition: background 0.2s;
    }
    button:hover { background: #e0e0e0; }

    /* optional colour legend */
    #legend {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.3rem;
      margin-top: 1rem;
    }
    .swatch {
      width: 1.2rem;
      height: 1.2rem;
      border: 1px solid #333;
      border-radius: 0.2rem;
    }
  </style>
</head>
<body>
  <h1>No 2×2 Monochrome <em>or Checkerboard</em> Grid</h1>
  <canvas id="grid" width="400" height="400"></canvas>

  <div id="controls">
    <label>Grid size (n × n):
      <input type="number" id="size" value="20" min="4" max="200" step="1" />
    </label>
    <label>Colours:
      <input type="number" id="colors" value="2" min="2" max="20" step="1" />
    </label>
    <button id="generate">Generate</button>
  </div>

  <div id="legend"></div>

  <script>
    /* =====================================================================
       Helper: map colour index ➜ visible colour (HSL for multi‑colour, BW when k=2)
    ===================================================================== */
    function indexToColour(i, k) {
      if (k === 2) return i === 0 ? "#fff" : "#000";
      const hue = (i * 360) / k;
      return `hsl(${hue} 70% 50%)`;
    }

    /* =====================================================================
       Forbidden‑pattern detector for a 2×2 block.
       Returns true if block is monochrome OR checkerboard.
       Inputs are integers 0..k‑1 (already chosen colours).
    ===================================================================== */
    function isForbidden(nw, n, w, x) {
      // Monochrome
      if (nw === n && n === w && w === x) return true;

      // Checkerboard orientation 1:  nw  n
      //                             w   x   where nw==x, n==w, and those two colours differ
      if (nw === x && n === w && nw !== n) return true;

      // Checkerboard orientation 2:  nw  n
      //                             w   x   where nw==w, n==x, and those two colours differ
      if (nw === w && n === x && nw !== n) return true;

      return false; // pattern allowed
    }

    /* =====================================================================
       Greedy fill that avoids **both** monochrome *and* checkerboard 2×2 blocks.
    ===================================================================== */
    function generateGrid(rows, cols, k) {
      const g = Array.from({ length: rows }, () => Array(cols).fill(null));

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          const choices = [];
          for (let colour = 0; colour < k; colour++) {
            // If we are on first row/col, no complete 2×2 block yet ⇒ always allowed
            if (r === 0 || c === 0) {
              choices.push(colour);
              continue;
            }
            const nw = g[r - 1][c - 1];
            const n  = g[r - 1][c];
            const w  = g[r][c - 1];
            if (!isForbidden(nw, n, w, colour)) choices.push(colour);
          }

          // Safety: there should *always* be at least one legal colour.
          if (choices.length === 0) {
            console.error(`No legal colour at (${r},${c}). This should never happen.`);
            choices.push(0); // fallback to avoid crash
          }

          g[r][c] = choices[Math.floor(Math.random() * choices.length)];
        }
      }
      return g;
    }

    /* =====================================================================
       Draw the grid on the canvas
    ===================================================================== */
    function drawGrid(grid, k) {
      const canvas = document.getElementById("grid");
      const ctx = canvas.getContext("2d");
      const rows = grid.length;
      const cols = grid[0].length;
      const cellSize = Math.floor(Math.min(canvas.width / cols, canvas.height / rows));

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          ctx.fillStyle = indexToColour(grid[r][c], k);
          ctx.fillRect(c * cellSize, r * cellSize, cellSize, cellSize);
        }
      }
    }

    /* =====================================================================
       Colour‑legend helper
    ===================================================================== */
    function drawLegend(k) {
      const legend = document.getElementById("legend");
      legend.innerHTML = "";
      for (let i = 0; i < k; i++) {
        const swatch = document.createElement("div");
        swatch.className = "swatch";
        swatch.style.background = indexToColour(i, k);
        legend.appendChild(swatch);
      }
    }

    /* =====================================================================
       Main UI hook
    ===================================================================== */
    function run() {
      const sizeInput = document.getElementById("size");
      const colourInput = document.getElementById("colors");
      const size = Math.max(4, parseInt(sizeInput.value, 10) || 20);
      let k    = Math.max(2, parseInt(colourInput.value, 10) || 2);

      const grid = generateGrid(size, size, k);
      drawGrid(grid, k);
      drawLegend(k);
    }

    document.getElementById("generate").addEventListener("click", run);
    window.addEventListener("load", run);
  </script>
</body>
</html>
